# Development Guide: Sellh (ØµÙ„Ù‡)

> **Generated by BMAD document-project workflow â€” 2026-02-24**

---

## Prerequisites | Ø§Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø³Ø¨Ù‚Ø©

| Tool | Version | Purpose |
|------|---------|---------|
| Python | 3.10+ | Core runtime |
| pip | Latest | Package manager |
| VS Code | Latest | Recommended IDE |
| Git | Latest | Version control |
| SQLite | Built-in | Phase 1 database |

---

## Quick Start | Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø³Ø±ÙŠØ¹Ø©

### 1. Clone / Setup Project
```bash
# Navigate to project directory
cd "Sellh ØµÙ„Ù‡"

# Create a Python virtual environment
python -m venv venv

# Activate virtual environment
# On Windows:
venv\Scripts\activate
# On macOS/Linux:
source venv/bin/activate
```

### 2. Install Dependencies
```bash
pip install -r requirements.txt
```

**Core dependencies (requirements.txt should include):**
```
flask>=2.3.0
sentence-transformers>=2.2.0
streamlit>=1.28.0
sqlalchemy>=2.0.0
bcrypt>=4.0.0
python-dotenv>=1.0.0
torch>=2.0.0
scikit-learn>=1.3.0
pandas>=2.0.0
pytest>=7.4.0
```

### 3. Environment Configuration
```bash
# Copy example env file
cp .env.example .env

# Edit .env with your settings
```

**.env file contents:**
```env
# Flask Configuration
FLASK_APP=main.py
FLASK_ENV=development
FLASK_DEBUG=1
SECRET_KEY=your-secret-key-here-change-in-production

# Database
DATABASE_URL=sqlite:///sellh.db

# AI Model
AI_MODEL_NAME=paraphrase-multilingual-mpnet-base-v2
AI_MODEL_PATH=./ai/models/

# App Settings
LOCAL_CONTENT_TARGET=60.0
```

### 4. Initialize Database
```bash
# Create database tables from schema
python -c "from app import create_app, db; app = create_app(); app.app_context().push(); db.create_all()"

# OR run SQL schema directly:
sqlite3 sellh.db < database/schema.sql

# Seed development data (optional)
sqlite3 sellh.db < database/seed_data.sql
```

### 5. Download AI Model
```bash
# The AI model is downloaded automatically on first run
# Or pre-download manually:
python -c "from sentence_transformers import SentenceTransformer; SentenceTransformer('paraphrase-multilingual-mpnet-base-v2')"
```

---

## Running the Application | ØªØ´ØºÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚

### Run Flask API Backend
```bash
python main.py
# OR
flask run --host=0.0.0.0 --port=5000
```
ðŸ“ API available at: `http://localhost:5000`

### Run Streamlit Dashboard
```bash
streamlit run dashboard/main.py
```
ðŸ“ Dashboard available at: `http://localhost:8501`

---

## Development Workflow | Ø³ÙŠØ± Ø¹Ù…Ù„ Ø§Ù„ØªØ·ÙˆÙŠØ±

### Typical Development Cycle

```
1. Activate virtual environment
2. Make code changes
3. Run tests: pytest tests/
4. Run Flask: flask run
5. Open Streamlit: streamlit run dashboard/main.py
6. Test in browser
7. Commit changes
```

### Adding a New API Endpoint
1. Create/edit route file in `app/routes/`
2. Add business logic in `app/services/`
3. Register Blueprint in `app/__init__.py` if new file
4. Add tests in `tests/test_api.py`
5. Update `api-contracts.md` documentation

### Adding a New Database Table
1. Write migration SQL in `database/migrations/`
2. Create SQLAlchemy model in `app/models/`
3. Update `data-models.md` documentation

---

## Testing | Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª

### Run All Tests
```bash
pytest tests/ -v
```

### Run Specific Test File
```bash
pytest tests/test_ai_matching.py -v
pytest tests/test_api.py -v
```

### Test the AI Matching Engine
```bash
python -c "
from app.services.ai_matching import find_matches
results = find_matches('Wooden executive office desk')
for r in results[:3]:
    print(f'[{r[\"rank\"]}] {r[\"product_name\"]} â€” Score: {r[\"similarity_score\"]:.2f}')
"
```

---

## Common Development Tasks | Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ø´Ø§Ø¦Ø¹Ø©

### Add a Saudi Factory (Admin)
Use the API: `POST /api/factories` with Admin session

Or directly via SQL:
```sql
INSERT INTO FACTORY (name, location, license_number)
VALUES ('Ø§Ø³Ù… Ø§Ù„Ù…ØµÙ†Ø¹', 'Ø§Ù„Ø±ÙŠØ§Ø¶', 'SA-2026-XXX');
```

### Test AI Matching Manually
```python
from sentence_transformers import SentenceTransformer
from sklearn.metrics.pairwise import cosine_similarity
import numpy as np

model = SentenceTransformer('paraphrase-multilingual-mpnet-base-v2')

query = "Office wooden desk for executive use"
products = ["Ù…ÙƒØªØ¨ Ø®Ø´Ø¨ÙŠ Ù…ÙƒØªØ¨ÙŠ", "ÙƒØ±Ø³ÙŠ Ù…ÙƒØªØ¨ÙŠ", "Ø·Ø§ÙˆÙ„Ø© Ø§Ø¬ØªÙ…Ø§Ø¹Ø§Øª"]

query_embedding = model.encode([query])
product_embeddings = model.encode(products)

scores = cosine_similarity(query_embedding, product_embeddings)[0]
for product, score in zip(products, scores):
    print(f"{product}: {score:.3f}")
```

### Reset Database
```bash
rm sellh.db
python -c "from app import create_app, db; app = create_app(); app.app_context().push(); db.create_all()"
```

---

## VS Code Setup | Ø¥Ø¹Ø¯Ø§Ø¯ VS Code

### Recommended Extensions
- Python (Microsoft)
- Pylance (Microsoft)  
- SQLite Viewer
- REST Client (for API testing)
- GitLens

### settings.json
```json
{
  "python.defaultInterpreterPath": "./venv/Scripts/python.exe",
  "python.linting.enabled": true,
  "python.linting.pylintEnabled": true,
  "editor.formatOnSave": true
}
```

---

## Troubleshooting | Ø§Ø³ØªÙƒØ´Ø§Ù Ø§Ù„Ø£Ø®Ø·Ø§Ø¡

| Problem | Solution |
|---------|----------|
| `ModuleNotFoundError` | Run `pip install -r requirements.txt` |
| AI model download slow | Pre-download using script above |
| DB locked error (SQLite) | Close other DB connections |
| Port 5000 in use | `flask run --port=5001` |
| Streamlit page not loading | Check firewall / try port 8502 |
| Low AI match scores | Try a more descriptive item description |

---

## Deployment (Future Production) | Ø§Ù„Ù†Ø´Ø± Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„ÙŠ

### Phase 2: Simple VPS Deployment
```bash
# Install production server
pip install gunicorn

# Run with gunicorn
gunicorn -w 4 -b 0.0.0.0:5000 main:app

# Use nginx as reverse proxy
# Point to localhost:5000
```

### Environment for Production
```env
FLASK_ENV=production
FLASK_DEBUG=0
DATABASE_URL=postgresql://user:pass@host/sellh
SECRET_KEY=very-long-random-secret-key
```
