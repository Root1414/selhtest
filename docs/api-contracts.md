# API Contracts: Sellh (ØµÙ„Ù‡)

> **Generated by BMAD document-project workflow â€” 2026-02-24**

---

## API Overview | Ù†Ø¨Ø°Ø© Ø¹Ù† Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø¨Ø±Ù…Ø¬ÙŠØ©

**Framework:** Flask (Python)  
**Base URL:** `http://localhost:5000/api` (development)  
**Auth:** Session-based (current) â†’ JWT (future)  
**Format:** JSON request/response bodies

---

## Authentication Endpoints | Ù†Ù‚Ø§Ø· Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©

### POST /api/auth/login
**Purpose:** Authenticate user and create session

**Request Body:**
```json
{
  "username": "string",
  "password": "string"
}
```

**Response (200 OK):**
```json
{
  "success": true,
  "user": {
    "id": 1,
    "username": "admin_user",
    "role": "Admin"
  },
  "message": "Login successful"
}
```

**Response (401 Unauthorized):**
```json
{
  "success": false,
  "message": "Invalid credentials"
}
```

---

### POST /api/auth/logout
**Purpose:** End user session

**Response (200 OK):**
```json
{
  "success": true,
  "message": "Logged out"
}
```

---

## Factory Management Endpoints | Ù†Ù‚Ø§Ø· Ù†Ù‡Ø§ÙŠØ© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ØµØ§Ù†Ø¹
> ğŸ”’ **Admin only**

### GET /api/factories
**Purpose:** List all Saudi factories

**Response (200 OK):**
```json
{
  "factories": [
    {
      "id": 1,
      "name": "Ø´Ø±ÙƒØ© Ø§Ù„Ø£Ø«Ø§Ø« Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠ",
      "location": "Ø§Ù„Ø±ÙŠØ§Ø¶",
      "license_number": "SA-2023-0042",
      "created_at": "2026-01-15T10:00:00Z"
    }
  ],
  "total": 42
}
```

---

### POST /api/factories
**Purpose:** Register a new Saudi factory

**Request Body:**
```json
{
  "name": "string",
  "location": "string",
  "license_number": "string",
  "contact_info": "string"
}
```

**Response (201 Created):**
```json
{
  "success": true,
  "factory_id": 43,
  "message": "Factory registered successfully"
}
```

---

### PUT /api/factories/{id}
**Purpose:** Update factory information

**Response (200 OK):**
```json
{
  "success": true,
  "message": "Factory updated"
}
```

---

## Local Product Endpoints | Ù†Ù‚Ø§Ø· Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©
> ğŸ”’ **Admin only** (write operations)

### GET /api/products
**Purpose:** List all local products with optional filtering

**Query Parameters:**
| Param | Type | Description |
|-------|------|-------------|
| `category_id` | integer | Filter by category |
| `factory_id` | integer | Filter by factory |
| `q` | string | Search term |

**Response (200 OK):**
```json
{
  "products": [
    {
      "id": 5,
      "name": "Ù…ÙƒØªØ¨ Ø®Ø´Ø¨ÙŠ Ù…ÙƒØªØ¨ÙŠ",
      "description": "Office wooden desk, 140Ã—70 cm, made in Riyadh",
      "factory": {
        "id": 1,
        "name": "Ø´Ø±ÙƒØ© Ø§Ù„Ø£Ø«Ø§Ø« Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠ",
        "location": "Ø§Ù„Ø±ÙŠØ§Ø¶"
      },
      "category": {
        "id": 2,
        "name": "Office Furniture"
      },
      "price": 850.00
    }
  ],
  "total": 157
}
```

---

### POST /api/products
**Purpose:** Add a new local product to the catalogue

**Request Body:**
```json
{
  "factory_id": 1,
  "category_id": 2,
  "name": "string",
  "description": "string",
  "price": 850.00,
  "unit": "piece"
}
```

**Response (201 Created):**
```json
{
  "success": true,
  "product_id": 158
}
```

---

## Procurement & AI Matching Endpoints | Ù†Ù‚Ø§Ø· Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª ÙˆØ§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø©

### POST /api/procurement/match
**Purpose:** Submit a procurement item and get AI-matched local alternatives

> Accessible by **Buyer** role

**Request Body:**
```json
{
  "description": "Wooden office desk for executive use",
  "quantity": 10,
  "unit": "piece",
  "origin_country": "Germany",
  "estimated_value": 15000.00
}
```

**Response (200 OK):**
```json
{
  "procurement_id": 88,
  "matches": [
    {
      "rank": 1,
      "similarity_score": 0.94,
      "product": {
        "id": 5,
        "name": "Ù…ÙƒØªØ¨ Ø®Ø´Ø¨ÙŠ Ù…ÙƒØªØ¨ÙŠ",
        "description": "Office wooden desk, 140Ã—70 cm",
        "price": 850.00
      },
      "factory": {
        "id": 1,
        "name": "Ø´Ø±ÙƒØ© Ø§Ù„Ø£Ø«Ø§Ø« Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠ",
        "location": "Ø§Ù„Ø±ÙŠØ§Ø¶"
      }
    },
    {
      "rank": 2,
      "similarity_score": 0.87,
      "product": {
        "id": 12,
        "name": "Ø·Ø§ÙˆÙ„Ø© Ù…ÙƒØªØ¨ÙŠØ© ÙØ§Ø®Ø±Ø©",
        "description": "Executive office table, adjustable height"
      },
      "factory": {
        "id": 3,
        "name": "Ù…ØµÙ†Ø¹ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„ØµÙ†Ø§Ø¹ÙŠØ©",
        "location": "Ø¬Ø¯Ø©"
      }
    }
  ],
  "total_matches": 8
}
```

---

### GET /api/procurement/{id}/matches
**Purpose:** Retrieve match results for a previously submitted procurement item

**Response (200 OK):** Same as POST response above.

---

## Analytics Endpoints | Ù†Ù‚Ø§Ø· Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª

### GET /api/analytics/local-content-score
**Purpose:** Get the organization's current local content compliance score

**Response (200 OK):**
```json
{
  "local_content_score": 67.4,
  "target_threshold": 60.0,
  "status": "green",
  "items_matched": 234,
  "items_total": 347,
  "trend": [
    {"month": "2026-01", "score": 61.2},
    {"month": "2026-02", "score": 67.4}
  ]
}
```

**Status values:**
| Value | Meaning |
|-------|---------|
| `"green"` | Score â‰¥ target (safe) |
| `"yellow"` | Score within 5% of target (warning) |
| `"red"` | Score below target (critical) |

---

## Error Codes | Ø±Ù…ÙˆØ² Ø§Ù„Ø£Ø®Ø·Ø§Ø¡

| HTTP Status | Code | Description |
|-------------|------|-------------|
| 400 | `INVALID_REQUEST` | Missing or invalid request parameters |
| 401 | `UNAUTHORIZED` | Not authenticated |
| 403 | `FORBIDDEN` | Insufficient role permissions |
| 404 | `NOT_FOUND` | Resource not found |
| 422 | `VALIDATION_ERROR` | Data validation failed |
| 500 | `INTERNAL_ERROR` | Server-side error |

**Error Response Format:**
```json
{
  "success": false,
  "error_code": "FORBIDDEN",
  "message": "Admin role required for this operation"
}
```
