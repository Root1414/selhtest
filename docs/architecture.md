# Architecture Document: Sellh (صله)

> **Generated by BMAD document-project workflow — 2026-02-24**

---

## 1. Executive Summary | الملخص التنفيذي

Sellh is a **Layered MVC Monolith** with an integrated AI engine. It is a Python-based web application using Flask as the HTTP framework, SQL as the data store, and Sentence-Transformers as the semantic matching engine. The current phase uses Streamlit for rapid frontend prototyping. The application follows a three-module architecture: Factory/Product Registry, AI Recommendation Engine, and Strategic Analytics Dashboard.

---

## 2. Architecture Pattern | نمط المعمارية

### Current: Monolithic Layered Architecture

```
┌─────────────────────────────────────────────────────┐
│              PRESENTATION LAYER                     │
│  Streamlit Dashboard  │  Flask HTML Templates       │
└──────────────┬──────────────────────────────────────┘
               │
┌──────────────▼──────────────────────────────────────┐
│              APPLICATION LAYER (Flask)              │
│  Route Handlers / Controllers / Middleware          │
│  - Auth (Admin / Buyer roles)                       │
│  - Factory management endpoints                     │
│  - Procurement processing endpoints                 │
│  - Analytics aggregation                           │
└──────────────┬──────────────────────────────────────┘
               │
┌──────────────▼──────────────────────────────────────┐
│              BUSINESS LOGIC / AI ENGINE             │
│  Sentence-Transformers (NLP Semantic Matching)      │
│  - Product description vectorization               │
│  - Cosine similarity scoring                       │
│  - Supplier ranking (cost + proximity + score)     │
└──────────────┬──────────────────────────────────────┘
               │
┌──────────────▼──────────────────────────────────────┐
│              DATA LAYER (SQL)                       │
│  USERS │ FACTORY │ LOCAL_PRODUCT │ PROCUREMENT_ITEM │
│                    AI_MATCH_LOG                     │
└─────────────────────────────────────────────────────┘
```

### Future: Microservices Architecture (Phase 3)

```
[React Frontend]
      │
[Node.js API Gateway]
      ├── [AI Matching Microservice] ── [Vector DB (Pinecone/Milvus)]
      ├── [Data Management Service] ── [SQL Database]
      └── [Analytics Service] ── [SQL Database]
```

---

## 3. Technology Stack | التقنيات المستخدمة

| Category | Technology | Version | Purpose |
|----------|-----------|---------|---------|
| **Language** | Python | 3.10+ | Core backend language |
| **Web Framework** | Flask | Latest | HTTP routing, middleware, API |
| **Database** | SQL (SQLite/PostgreSQL) | — | Relational data storage |
| **AI / NLP** | Sentence-Transformers | Latest | Semantic product matching |
| **Frontend (current)** | Streamlit | Latest | Rapid analytics dashboard |
| **Frontend (future)** | React.js | Latest | Full interactive platform |
| **Dev Environment** | VS Code | Latest | Development IDE |
| **Future AI** | RAG + GPT-4/Gemini | — | Advanced LLM matching |
| **Future DB** | Pinecone / Milvus | — | Vector search at scale |

---

## 4. System Modules | وحدات النظام

### 4.1 Module 1: Factory & Product Registry (وحدة سجل المصانع والمنتجات)

**Responsibilities:**
- CRUD operations for Saudi factory data (name, location, industrial license)
- Standardized product category management to prevent duplication
- Admin-only access control for registry management

**Key Flows:**
```
Admin Login → Manage Factories → Add/Edit Local Product →
Assign to Category → Publish to Procurement Matching
```

### 4.2 Module 2: AI Recommendation Engine (محرك التوصيات)

**Responsibilities:**
- Receive procurement item descriptions from buyers
- Vectorize text using Sentence-Transformers (pre-trained multilingual model)
- Calculate cosine similarity against all `LOCAL_PRODUCT` entries
- Rank matching factories by: match score + cost + geographic proximity
- Log all matches to `AI_MATCH_LOG`

**Algorithm Flow:**
```
Procurement Item Description
         │
    [Tokenize + Embed] ← Sentence-Transformers model
         │
    [Cosine Similarity] ← Compare vs all LOCAL_PRODUCT vectors
         │
    [Score + Rank] ← Weight: similarity × cost × proximity
         │
    [Return Top N matches] → AI_MATCH_LOG entry
```

### 4.3 Module 3: Strategic Analytics Dashboard (لوحة التحليلات الاستراتيجية)

**Responsibilities:**
- Calculate organization's current Local Content Score
- Display Compliance Risk Indicator (Green/Yellow/Red)
- Trend visualization over time
- Alert before thresholds are breached

---

## 5. Data Architecture | معمارية البيانات

See [Data Models](./data-models.md) for full schema documentation.

**Core Entity Relationships:**
```
USERS (1:N) → PROCUREMENT_ITEM
FACTORY (1:N) → LOCAL_PRODUCT
LOCAL_PRODUCT (M:N via AI_MATCH_LOG) → PROCUREMENT_ITEM
```

---

## 6. Authentication & Security | المصادقة والأمان

| Aspect | Current Approach |
|--------|-----------------|
| **Auth mechanism** | Custom Flask session-based auth |
| **Roles** | Admin, Buyer |
| **Password storage** | Hashed (bcrypt recommended) |
| **Route protection** | Flask decorators / middleware |
| **Future** | JWT tokens + Node.js Gateway |

---

## 7. API Design | تصميم الواجهة البرمجية

See [API Contracts](./api-contracts.md) for full endpoint documentation.

**Pattern:** RESTful HTTP via Flask routes  
**Data format:** JSON  
**Auth:** Session-based (current), JWT (future)

---

## 8. Deployment Architecture | معمارية النشر

### Current (Development)
```
Developer Machine
└── Python 3.10+
    └── Flask dev server (localhost:5000)
        └── SQLite database (local file)
        └── Streamlit (localhost:8501)
```

### Future (Production)
```
Cloud Server (AWS/Azure/GCP)
├── React.js frontend (CDN)
├── Flask API (Gunicorn + Nginx)
├── PostgreSQL Database (managed)
└── Vector DB (Pinecone cloud)
```

---

## 9. Key Design Decisions | قرارات التصميم الرئيسية

| Decision | Choice | Rationale |
|----------|--------|-----------|
| **Language** | Python | Best NLP library ecosystem, rapid development |
| **AI approach** | Sentence-Transformers (current) | Proven semantic similarity, easy deployment |
| **Frontend Phase 1** | Streamlit | Fastest path to demo-ready AI dashboard |
| **DB Phase 1** | SQL | Relational integrity, familiar query model |
| **Architecture Phase 1** | Monolith | Simpler to build for academic timeline |
| **Future AI** | RAG + LLMs | Handles complex queries, reads PDF catalogs |
| **Future DB** | Vector DB | Scales to millions of products semantically |

---

## 10. Quality Attributes | جودة المنظومة

| Attribute | Strategy |
|-----------|----------|
| **Accuracy** | Semantic NLP matching vs. keyword matching |
| **Scalability** | Phase 3: Microservices + Vector DB |
| **Maintainability** | Modular Flask blueprints, separated AI engine |
| **Compliance** | AI_MATCH_LOG audit trail for all decisions |
| **Usability** | Streamlit dashboard (Phase 1), React (Phase 2) |
