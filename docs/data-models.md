# Data Models: Sellh (صله)

> **Generated by BMAD document-project workflow — 2026-02-24**

---

## Database Overview | نبذة عن قاعدة البيانات

**Type:** Relational SQL (SQLite in Phase 1, PostgreSQL recommended for production)  
**Design approach:** Normalized schema (3NF) to ensure data integrity and prevent duplication

---

## Entity Relationship Diagram | مخطط العلاقات

```
┌─────────────┐           ┌──────────────────┐           ┌─────────────┐
│    USERS    │           │     FACTORY       │           │  CATEGORY   │
│─────────────│           │──────────────────│           │─────────────│
│ id (PK)     │           │ id (PK)           │           │ id (PK)     │
│ username    │           │ name              │           │ name        │
│ password    │           │ location          │           │ description │
│ role        │           │ license_number    │           └──────┬──────┘
│ created_at  │           │ created_at        │                  │ (1:N)
└──────┬──────┘           └────────┬──────────┘                  │
       │ (1:N)                     │ (1:N)                       │
       │                           │                             │
       ▼                           ▼                             ▼
┌──────────────────┐      ┌────────────────────────────────────────────┐
│ PROCUREMENT_ITEM │      │              LOCAL_PRODUCT                  │
│──────────────────│      │────────────────────────────────────────────│
│ id (PK)          │      │ id (PK)                                     │
│ user_id (FK)     │      │ factory_id (FK) → FACTORY                  │
│ description      │      │ category_id (FK) → CATEGORY                │
│ quantity         │      │ name                                        │
│ unit             │      │ description                                 │
│ origin_country   │      │ price                                       │
│ created_at       │      │ created_at                                  │
└──────┬───────────┘      └────────────┬───────────────────────────────┘
       │ (M:N via AI_MATCH_LOG)        │
       └──────────────┬────────────────┘
                      ▼
          ┌───────────────────────────┐
          │       AI_MATCH_LOG        │
          │───────────────────────────│
          │ id (PK)                   │
          │ procurement_id (FK)       │
          │ local_product_id (FK)     │
          │ similarity_score (FLOAT)  │
          │ recommendation_rank (INT) │
          │ matched_at (DATETIME)     │
          └───────────────────────────┘
```

---

## Table Definitions | تعريفات الجداول

### 1. USERS (المستخدمون)

**Purpose:** Manages authentication and role-based access control

| Column | Type | Nullable | Description |
|--------|------|----------|-------------|
| `id` | INTEGER | NO | Primary key, auto-increment |
| `username` | VARCHAR(100) | NO | Unique login name |
| `password_hash` | VARCHAR(255) | NO | Bcrypt-hashed password |
| `role` | ENUM('Admin', 'Buyer') | NO | User permission level |
| `created_at` | DATETIME | NO | Account creation timestamp |

**Constraints:**
- `UNIQUE` on `username`
- `CHECK` role IN ('Admin', 'Buyer')

---

### 2. FACTORY (المصانع السعودية)

**Purpose:** Registry of Saudi manufacturing facilities

| Column | Type | Nullable | Description |
|--------|------|----------|-------------|
| `id` | INTEGER | NO | Primary key, auto-increment |
| `name` | VARCHAR(200) | NO | Factory official name |
| `location` | VARCHAR(200) | NO | City / region in Saudi Arabia |
| `license_number` | VARCHAR(100) | YES | Industrial license number |
| `contact_info` | TEXT | YES | Contact details |
| `created_at` | DATETIME | NO | Registry creation timestamp |
| `created_by` | INTEGER | NO | FK → USERS.id (Admin only) |

**Relationships:** `1:N` with `LOCAL_PRODUCT`

---

### 3. CATEGORY (فئات المنتجات)

**Purpose:** Unified product categories to standardize local product classification and prevent duplication

| Column | Type | Nullable | Description |
|--------|------|----------|-------------|
| `id` | INTEGER | NO | Primary key, auto-increment |
| `name` | VARCHAR(150) | NO | Category name (e.g., "Office Furniture") |
| `description` | TEXT | YES | Category description |

**Constraints:**
- `UNIQUE` on `name`

---

### 4. LOCAL_PRODUCT (المنتجات المحلية)

**Purpose:** Catalogue of Saudi-made products that can substitute imported items

| Column | Type | Nullable | Description |
|--------|------|----------|-------------|
| `id` | INTEGER | NO | Primary key, auto-increment |
| `factory_id` | INTEGER | NO | FK → FACTORY.id |
| `category_id` | INTEGER | NO | FK → CATEGORY.id |
| `name` | VARCHAR(200) | NO | Product name |
| `description` | TEXT | NO | Full description (used for AI matching) |
| `price` | DECIMAL(12,2) | YES | Unit price in SAR |
| `unit` | VARCHAR(50) | YES | Unit of measure |
| `created_at` | DATETIME | NO | Catalog addition timestamp |

**Relationships:** `N:M` with `PROCUREMENT_ITEM` (resolved via `AI_MATCH_LOG`)

---

### 5. PROCUREMENT_ITEM (عناصر المشتريات المستوردة)

**Purpose:** Stores imported procurement items submitted by buyers for local alternative matching

| Column | Type | Nullable | Description |
|--------|------|----------|-------------|
| `id` | INTEGER | NO | Primary key, auto-increment |
| `user_id` | INTEGER | NO | FK → USERS.id (Buyer role) |
| `description` | TEXT | NO | Item description (input to AI) |
| `quantity` | DECIMAL(10,2) | YES | Quantity needed |
| `unit` | VARCHAR(50) | YES | Unit of measure |
| `origin_country` | VARCHAR(100) | YES | Current import country |
| `estimated_value` | DECIMAL(12,2) | YES | Estimated value in SAR |
| `created_at` | DATETIME | NO | Submission timestamp |
| `status` | ENUM('pending', 'matched', 'approved') | NO | Processing status |

---

### 6. AI_MATCH_LOG (سجل مطابقة الذكاء الاصطناعي)

**Purpose:** Audit table recording every AI matching operation; resolves the M:N relationship between procurement items and local products

| Column | Type | Nullable | Description |
|--------|------|----------|-------------|
| `id` | INTEGER | NO | Primary key, auto-increment |
| `procurement_id` | INTEGER | NO | FK → PROCUREMENT_ITEM.id |
| `local_product_id` | INTEGER | NO | FK → LOCAL_PRODUCT.id |
| `similarity_score` | FLOAT | NO | Cosine similarity score (0.0–1.0) |
| `recommendation_rank` | INTEGER | NO | Rank among matches for this procurement item |
| `matched_at` | DATETIME | NO | Timestamp of AI match operation |

**Indexes:** 
- `(procurement_id, recommendation_rank)` — for ranking queries
- `(local_product_id)` — for analytics queries

---

## Data Integrity & Constraints | سلامة البيانات

| Rule | Implementation |
|------|---------------|
| **Referential integrity** | Foreign keys with CASCADE DELETE on FACTORY → LOCAL_PRODUCT |
| **No duplicate categories** | UNIQUE constraint on CATEGORY.name |
| **No duplicate usernames** | UNIQUE constraint on USERS.username |
| **Role validation** | CHECK constraint on USERS.role |
| **Score range** | CHECK 0.0 ≤ similarity_score ≤ 1.0 |

---

## Migration Strategy | استراتيجية الترحيل

### Phase 1 → Phase 2 (Production SQL)
- Migrate SQLite → PostgreSQL
- Add indexing strategy for large datasets
- Add full-text search extensions (pg_trgm)

### Phase 2 → Phase 3 (Vector DB Addition)
- Keep SQL for structured data
- Add Pinecone/Milvus as a **side-car** vector search engine
- Sync LOCAL_PRODUCT descriptions → vector embeddings on insert/update
- AI matching will query vector DB, then join results with SQL for metadata
